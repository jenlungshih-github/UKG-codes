/**************************************** Created By: May Xu	* Table: This SP creates table [dbo].UKG_JOBGROUP	to create file BS_Jobs_Import.csv* EXEC 	[dbo].UKG_JOBGROUP_BUILD	* -- 04/28/2025 May Xu: Created* -- 07/07/2025 Jim Shih* -- Per J.k. The Job Full Name should also be the Job Group and the Description should be the Job Code Title.*-- 7/14/2025 Jim Shih*-- migrate from hs-ssisp-v*--  FROM EcoTime_RPT.TEST.TSR_JobGroups --> dbo.JobGroups*-- 7/28/2025 Jim Shih*-- 7/28/2025 May Xu:  add 30 day snapshot*-- from dbo.JobGroups --> [hts].[UKG_JobGroups]*-- 8/4/2025   Jim Shih: add DROP TABLE IF EXISTS******************************************/		CREATE PROCEDURE "dbo"."UKG_JOBGROUP_BUILD"AS  BEGIN DROP TABLE IF EXISTS [dbo].UKG_JOBGROUP;SELECT  DISTINCT JOBGROUP AS [Job Name],--JobGroupTitle AS [Job Full Name],JOBGROUP AS [Job Full Name],JobGroupTitle AS [Job Description],'' AS [Display Order],'1900-01-01' AS [Effective Date],'3000-01-01' AS [Expiration Date],'' AS [Color],'' AS [Job Code],'' AS [External ID]INTO [dbo].UKG_JOBGROUP	 FROM [hts].[UKG_JobGroups]WHERE 	1=1   -- ***LOOP TO DROP ANY 30 DAY OLD and TODAYÂ’S UKG_JOBGROUP_SNAPSHOT TABLES ***--DECLARE @SQL_DROP NVARCHAR(MAX)          SELECT     @SQL_DROP = COALESCE(@SQL_DROP + ' ;', '') +                'DROP TABLE ' + QUOTENAME(S.NAME) + '.' + QUOTENAME(T.NAME)        FROM SYS.SCHEMAS S          INNER JOIN SYS.TABLES T ON T.SCHEMA_ID = S.SCHEMA_ID           WHERE S.NAME IN ( 'BCK')             AND T.NAME LIKE 'UKG_JOBGROUP_SNAPSHOT_%'      AND ( CAST(SUBSTRING (T.NAME,23, 10 ) AS DATE) <  CAST(DATEADD(DAY,-30, GETDATE())   AS DATE)   OR CAST(SUBSTRING (T.NAME,23, 10 ) AS DATE) =  CAST(GETDATE()       AS DATE) )                     --PRINT @SQL_DROP  EXEC(@SQL_DROP) --*** CREATE SNAPSHOT TABLE  ***--DECLARE @SQL_CREATE NVARCHAR(MAX) ;  DECLARE @SNAPSHOT_TABLENAME NVARCHAR(50); SET @SNAPSHOT_TABLENAME = 'UKG_JOBGROUP_SNAPSHOT_'+CAST(CAST(GETDATE() AS DATE) AS CHAR(10));       SELECT     @SQL_CREATE = 	--N'SELECT  * INTO BCK.[' +  @SNAPSHOT_TABLENAME + ']' + ' FROM dbo.UKG_JOBGROUP';            N'DROP TABLE IF EXISTS bck.[' + @SNAPSHOT_TABLENAME + ']; ' +        N'SELECT * INTO bck.[' + @SNAPSHOT_TABLENAME + '] FROM dbo.UKG_JOBGROUP';    --PRINT @SQL_CREATE;EXEC(@SQL_CREATE)END;



SELECT J.POSITION_NBR, J.EMPLID, J.HR_STATUS, j.EMPL_RCD, J.DEPTID, BUSINESS_UNIT, LOCATION,
    JOB_INDICATOR, FTE, UNION_CD, JOBCODE,
    ROW_NUMBER() OVER(Partition by emplid ORDER BY (CASE WHEN JOB_INDICATOR = 'N' THEN 'Z' ELSE JOB_INDICATOR END ), FTE DESC ) AS ROW_NO
FROM health_ods.[HEALTH_ODS].[STABLE].PS_JOB J
WHERE
J.POSITION_NBR IN (
    '40688126', '40695802', '40697146', '40699053', '40700950', '40702349',
    '40703703', '40704589', '40709698', '40709834', '40887613', '41042579'
)
    and
    J.DML_IND <> 'D'
    --AND J.HR_STATUS = 'A'
    AND J.EFFDT =
     (SELECT MAX(J1.EFFDT)
    FROM [HEALTH_ODS].[STABLE].PS_JOB J1
    WHERE J1.EMPLID = J.EMPLID
        AND J1.EMPL_RCD = J.EMPL_RCD
        AND J1.EFFDT  <=  GETDATE()
        AND J1.DML_IND <> 'D'    )
    AND J.EFFSEQ =
     (SELECT MAX(J2.EFFSEQ)
    FROM [HEALTH_ODS].[STABLE].PS_JOB J2
    WHERE J2.EMPLID = J.EMPLID
        AND J2.EMPL_RCD = J.EMPL_RCD
        AND J2.EFFDT    = J.EFFDT AND J2.DML_IND <> 'D'  )
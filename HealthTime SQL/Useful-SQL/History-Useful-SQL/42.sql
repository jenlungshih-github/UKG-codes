SELECT
    POSITION_NBR,
    FDM_COMBO_CD,
    FISCAL_YEAR,
    dist_Pct
FROM health_ods.[health_ods].[RPT].[CURRENT_POSITION_PRI_FIN_UNIT]
WHERE POSITION_NBR IN (
    '40686393', '40688062', '40688555', '40689240', '40689452', '40690304',
    '40692123', '40694001', '40696152', '40697678', '40698123', '40700336',
    '40701587', '40701680', '40702690', '40703385', '40705215', '40706553',
    '40709083', '40709133', '40709768', '40710295', '40710922', '40732905',
    '40795973', '40828319', '40864636', '40873628', '40874269', '40881942',
    '40896329', '40897400', '40903439', '41027583', '41187984', '41187984'
)
    and FISCAL_YEAR=2026
;

-- Check which POSITION_NBR from the list are missing
WITH
    PositionList
    AS
    (
        SELECT POSITION_NBR
        FROM (VALUES
                ('40686393'),
                ('40688062'),
                ('40688555'),
                ('40689240'),
                ('40689452'),
                ('40690304'),
                ('40692123'),
                ('40694001'),
                ('40696152'),
                ('40697678'),
                ('40698123'),
                ('40700336'),
                ('40701587'),
                ('40701680'),
                ('40702690'),
                ('40703385'),
                ('40705215'),
                ('40706553'),
                ('40709083'),
                ('40709133'),
                ('40709768'),
                ('40710295'),
                ('40710922'),
                ('40732905'),
                ('40795973'),
                ('40828319'),
                ('40864636'),
                ('40873628'),
                ('40874269'),
                ('40881942'),
                ('40896329'),
                ('40897400'),
                ('40903439'),
                ('41027583'),
                ('41187984'),
                ('41187984')
    ) AS t(POSITION_NBR)
    ),
    Results
    AS
    (
        SELECT
            POSITION_NBR,
            FDM_COMBO_CD,
            FISCAL_YEAR,
            dist_Pct
        FROM health_ods.[health_ods].[RPT].[CURRENT_POSITION_PRI_FIN_UNIT]
        WHERE POSITION_NBR IN (
        '40686393', '40688062', '40688555', '40689240', '40689452', '40690304',
        '40692123', '40694001', '40696152', '40697678', '40698123', '40700336',
        '40701587', '40701680', '40702690', '40703385', '40705215', '40706553',
        '40709083', '40709133', '40709768', '40710295', '40710922', '40732905',
        '40795973', '40828319', '40864636', '40873628', '40874269', '40881942',
        '40896329', '40897400', '40903439', '41027583', '41187984', '41187984'
    )
            AND FISCAL_YEAR = 2026
    )
SELECT
    pl.POSITION_NBR as Requested_Position,
    CASE WHEN r.POSITION_NBR IS NULL THEN 'MISSING' ELSE 'FOUND' END as Status,
    r.FDM_COMBO_CD,
    r.FISCAL_YEAR,
    r.dist_Pct
FROM PositionList pl
    LEFT JOIN Results r ON pl.POSITION_NBR = r.POSITION_NBR
ORDER BY pl.POSITION_NBR;

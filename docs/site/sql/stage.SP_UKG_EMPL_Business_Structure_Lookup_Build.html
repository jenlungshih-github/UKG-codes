<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stage.SP_UKG_EMPL_Business_Structure_Lookup_Build - SQL Documentation</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">&larr; Back to Index</a>
        <h1>stage.SP_UKG_EMPL_Business_Structure_Lookup_Build</h1>
        <p class="description"><strong>Description:</strong> Employee business structure lookup build.</p>
        <h2>SQL Definition</h2>
        <pre><code>
                                                                                                                                                                                                                                                             

                                                                                                                                                                                                                                                             
CREATE           PROCEDURE [stage].[SP_UKG_EMPL_Business_Structure_Lookup_Build]
                                                                                                                                                                             
AS
                                                                                                                                                                                                                                                           
/*
                                                                                                                                                                                                                                                           
    File: SP_UKG_EMPL_Business_Structure_Lookup_Build.sql
                                                                                                                                                                                                    
    Version: 2025-09-06
                                                                                                                                                                                                                                      

                                                                                                                                                                                                                                                             
    Description:
                                                                                                                                                                                                                                             
    This stored procedure [stage].[SP_UKG_EMPL_Business_Structure_Lookup_Build] is designed to create or refresh the lookup table [stage].[UKG_EMPL_Business_Structure] in the HealthTime database.
                                                          
    - Drops the existing lookup table if it exists.
                                                                                                                                                                                                          
    - Creates a new table by selecting relevant columns from [dbo].[UKG_EMPLOYEE_DATA], including a concatenated business structure path.
                                                                                                                    
    - Excludes records where the organization is 'Non-Health'.
                                                                                                                                                                                               
    - Adds a Loaded_DT column to record the load timestamp for each row.
                                                                                                                                                                                     
    - Prints a confirmation message upon successful creation.
                                                                                                                                                                                                

                                                                                                                                                                                                                                                             
    Usage:
                                                                                                                                                                                                                                                   
    EXEC [stage].[SP_UKG_EMPL_Business_Structure_Lookup_Build]
                                                                                                                                                                                               
*/
                                                                                                                                                                                                                                                           

                                                                                                                                                                                                                                                             
-- exec [stage].[SP_UKG_EMPL_Business_Structure_Lookup_Build]
                                                                                                                                                                                                
BEGIN
                                                                                                                                                                                                                                                        
    SET NOCOUNT ON;
                                                                                                                                                                                                                                          

                                                                                                                                                                                                                                                             
    -- Drop the table if it exists
                                                                                                                                                                                                                           
    IF OBJECT_ID('stage.UKG_EMPL_Business_Structure', 'U') IS NOT NULL
                                                                                                                                                                                       
    BEGIN
                                                                                                                                                                                                                                                    
        DROP TABLE stage.UKG_EMPL_Business_Structure;
                                                                                                                                                                                                        
    END
                                                                                                                                                                                                                                                      

                                                                                                                                                                                                                                                             
    -- Create the lookup table
                                                                                                                                                                                                                               
    SELECT --top 10
                                                                                                                                                                                                                                          
        [Person Number]
                                                                                                                                                                                                                                      
          , [First Name]
                                                                                                                                                                                                                                     
          , [Last Name]
                                                                                                                                                                                                                                      
    	  , [Home Business Structure Level 5 - Fund Group] as FundGroup
                                                                                                                                                                                         
          , [Home Business Structure Level 1 - Organization] + '/' +
                                                                                                                                                                                         
          [Home Business Structure Level 2 - Entity] + '/' +
                                                                                                                                                                                                 
          [Home Business Structure Level 3 - Service Line] + '/' +
                                                                                                                                                                                           
          [Home Business Structure Level 4 - Financial Unit] + '/' +
                                                                                                                                                                                         
          [Home Business Structure Level 5 - Fund Group] AS [Parent Path]
                                                                                                                                                                                    
    INTO stage.UKG_EMPL_Business_Structure
                                                                                                                                                                                                                   

                                                                                                                                                                                                                                                             
    FROM [dbo].[UKG_EMPLOYEE_DATA]
                                                                                                                                                                                                                           
    WHERE [Home Business Structure Level 1 - Organization] != 'Non-Health';
                                                                                                                                                                                  

                                                                                                                                                                                                                                                             
    -- Add Loaded_DT column and update with current date
                                                                                                                                                                                                     
    ALTER TABLE stage.UKG_EMPL_Business_Structure ADD Loaded_DT DATETIME;
                                                                                                                                                                                    
    UPDATE stage.UKG_EMPL_Business_Structure SET Loaded_DT = GETDATE();
                                                                                                                                                                                      

                                                                                                                                                                                                                                                             
    PRINT 'Table stage.UKG_EMPL_Business_Structure has been successfully created.';
                                                                                                                                                                          
END
                                                                                                                                                                                                                                                          
</code></pre>
        <footer>Generated from: stage.SP_UKG_EMPL_Business_Structure_Lookup_Build.sql</footer>
    </div>
</body>
</html>
